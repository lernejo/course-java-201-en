<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="LoÃ¯c Ledoyen">
<title>Java 201 - Software Architecture</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Java 201 - Software Architecture</h1>
<div class="details">
<span id="author" class="author">LoÃ¯c Ledoyen</span><br>
<span id="email" class="email"><a href="mailto:ledoyen.loic@gmail.com">ledoyen.loic@gmail.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Java 201</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_tools_recap">1. Tools recap</a>
<ul class="sectlevel2">
<li><a href="#_git">1.1. Git</a></li>
<li><a href="#_git_concepts">1.2. Git concepts</a></li>
<li><a href="#_maven">1.3. Maven</a></li>
<li><a href="#_junit">1.4. JUnit</a></li>
</ul>
</li>
<li><a href="#_low_coupling_a_target_at_each_scale">2. Low coupling, a target at each scale</a>
<ul class="sectlevel2">
<li><a href="#_at_a_java_class_scale">2.1. At a Java class scale</a></li>
<li><a href="#_at_an_application_scale">2.2. At an application scale</a></li>
<li><a href="#_at_an_information_system_scale">2.3. At an information system scale</a></li>
</ul>
</li>
<li><a href="#_common_architecture_styles">3. Common architecture styles</a>
<ul class="sectlevel2">
<li><a href="#_n_tier">3.1. N-tier</a></li>
<li><a href="#_hexagonal">3.2. Hexagonal</a></li>
<li><a href="#_monolith_vs_micro_services">3.3. Monolith vs micro-services</a></li>
</ul>
</li>
<li><a href="#_scaling_relative_considerations">4. Scaling &amp; relative considerations</a>
<ul class="sectlevel2">
<li><a href="#_identify_spofs">4.1. Identify SPOFs</a></li>
<li><a href="#_identify_points_of_contention">4.2. Identify points of contention</a></li>
<li><a href="#_distribute_the_load">4.3. Distribute the load</a></li>
<li><a href="#_architecture_evolution_example">4.4. Architecture evolution example</a></li>
</ul>
</li>
<li><a href="#_architectural_documentation">5. Architectural documentation</a>
<ul class="sectlevel2">
<li><a href="#_readme">5.1. README</a></li>
<li><a href="#_c4">5.2. C4</a></li>
<li><a href="#_adr_architectural_decision_records">5.3. ADR (Architectural Decision Records)</a></li>
<li><a href="#_api_documentation">5.4. API documentation</a></li>
<li><a href="#_bdd_and_atdd">5.5. BDD and ATDD</a></li>
</ul>
</li>
<li><a href="#_technics_best_practices">6. Technics &amp; best practices</a>
<ul class="sectlevel2">
<li><a href="#_kiss_yagni_dry">6.1. KISS, YAGNI &amp; DRY</a></li>
</ul>
</li>
<li><a href="#_log_management">7. Log management</a>
<ul class="sectlevel2">
<li><a href="#_log_libraries">7.1. Log libraries</a></li>
<li><a href="#_gc_logs">7.2. GC logs</a></li>
<li><a href="#_heap_dump">7.3. Heap Dump</a></li>
</ul>
</li>
<li><a href="#_supervision">8. Supervision</a></li>
<li><a href="#_conclusion">Conclusion</a></li>
<li><a href="#_to_go_further">To go further</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
Architecture is about the important stuff.<br>
Whatever that is.
</blockquote>
<div class="attribution">
&#8212; Ralph Johnson
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>It means that the heart of thinking architecturally about software is to decide what is important, (i.e. what is architectural), and then expend energy on keeping those architectural elements in good condition.<br>
For a developer to become an architect, they need to be able to recognize what elements are important, recognizing what elements are likely to result in serious problems should they not be controlled.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Martin Fowler
</div>
</div>
<div class="paragraph">
<p>A piece of software tries to achieve several objectives depending on the context.<br>
Among these objectives, we encounter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maintainability</p>
</li>
<li>
<p>Testability</p>
</li>
<li>
<p>Reliability / Resilience</p>
</li>
<li>
<p>Scalability</p>
</li>
<li>
<p>Security</p>
</li>
<li>
<p>Performance</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Software architecture is the technical means used to meet the objectives set for a particular project while complying with constraints.</p>
</div>
<div class="paragraph">
<p>As all the objectives cannot be met in one development iteration, software architecture is the ideal compromise in regard to project priorities.</p>
</div>
<div class="paragraph">
<p>Constraints can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Short term realisation / deadline</p>
</li>
<li>
<p>Limited funding</p>
</li>
<li>
<p>Security compliance</p>
</li>
<li>
<p>Connection to a third party software using specific technology / protocol</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Priorities must be decided by all stakeholders, and periodically adjusted to follow the project evolution.<br>
It is a partnership.</p>
</div>
<div class="paragraph">
<p>The development team uses architecture principles to reach projects objectives in the best way.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_tools_recap">1. Tools recap</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_git">1.1. Git</h3>
<div class="paragraph">
<p>Git is a decentralized SCM (<strong>S</strong>ource <strong>C</strong>ode <strong>M</strong>anagement tool).</p>
</div>
<div class="paragraph">
<p>Decentralized means that they exists multiple remotes instances of the same repository on different servers.<br>
Typically, in the open-source community, when someone external to a project wants to contribute, this person starts by creating a copy of the repository (fork), work on this instance, then offer a submission (pull or merge request) to the project&#8217;s owners.</p>
</div>
<div class="paragraph">
<p>Git is broadly used today, and succeed to other SCM tools (CVS, SVN, Mercurial, etc.).<br>
These various tools offer the same ability to historize differentials, to allow to restore a previous version, or work on a new version in parallel, which will be later on merged on the main branch.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/git_sample.png" alt="git sample">
</div>
</div>
<div class="paragraph">
<p>Here is the vocabulary in use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>commit</strong> : a revision / version containing code modifications</p>
</li>
<li>
<p><strong>branch</strong> : un thread of commits</p>
</li>
<li>
<p><strong>tag</strong> : alias for a specific commit, ofter used to mark an <em>applicative version</em> (1.0.25 for example)</p>
</li>
<li>
<p><strong>merge</strong> : merge of one branch onto another</p>
</li>
<li>
<p><strong>checkout</strong> : retrieve locally the code from a remote server in a specific version</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_some_useful_commands">1.1.1. Some useful commands</h4>
<div class="ulist">
<ul>
<li>
<p>Initialize a repository</p>
<div class="ulist">
<ul>
<li>
<p><code>git clone &lt;url&gt;</code> : copy locally a remote repository</p>
</li>
<li>
<p>Ou <code>git init</code> : turn the current directory into a local repository. A default remote repository can later be attached using <code>git remote add origin &lt;url&gt;</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Update</p>
<div class="ulist">
<ul>
<li>
<p><code>git fetch --all --prune</code> : retrieve the Git database latest version</p>
</li>
<li>
<p><code>git pull</code> : on the current branch, retrieve the remote changes (merge or rebase, depending on the configuration)</p>
</li>
<li>
<p><code>git rebase origin/&lt;current-branch&gt;</code> : on the current branch, move local commits after those having been pushed on the remote repository</p>
</li>
</ul>
</div>
</li>
<li>
<p>Switch branches</p>
<div class="ulist">
<ul>
<li>
<p><code>git checkout &lt;branch&gt;</code> : set the working directory files in the latest version of <code>&lt;branch&gt;</code></p>
</li>
<li>
<p><code>git branch -b &lt;branch&gt;</code> : create a new branch named <code>&lt;branch&gt;</code> with the starting point being the latest commit</p>
</li>
</ul>
</div>
</li>
<li>
<p>Display changes</p>
<div class="ulist">
<ul>
<li>
<p><code>git status</code> : display indexed (green) and not-indexed (red) local changes along with commit differences with the default remote</p>
</li>
<li>
<p><code>git log --oneline -n 15</code> : display the last 15 commits of the current branch (including their hashes)</p>
</li>
<li>
<p><code>git diff --stat</code> : display a summary of local changes</p>
</li>
<li>
<p><code>git diff --word-diff=color &lt;file&gt;</code> : display the the local changes of the file <code>&lt;file&gt;</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Introduce changes</p>
<div class="ulist">
<ul>
<li>
<p><code>git add &lt;file&gt;</code> : add the file <code>&lt;file&gt;</code> to Git index</p>
</li>
<li>
<p><code>git add .</code> : add all (recursively) changed files to Git index</p>
</li>
<li>
<p><code>git reset &lt;file&gt;</code> : remove file <code>&lt;file&gt;</code> from Git index</p>
</li>
<li>
<p><code>git commit -m "&lt;title&gt;"</code> : create a new commit with all indexed changes with the title <code>&lt;title&gt;</code></p>
</li>
<li>
<p><code>git commit --amend --no-edit</code> : include all indexed changes in the latest commit</p>
</li>
<li>
<p><code>git commit --fixup &lt;hash&gt;</code> : create a new commit with all indexed changes, "tagged" as <em>fix</em>, targeting an existing commit of ID <code>&lt;hash&gt;</code></p>
</li>
<li>
<p><code>git rebase -i --autosquash &lt;hash&gt;</code> : start an interactive rebase until the commit of ID <code>&lt;hash&gt;</code> excluded, and moves <em>fixup</em> commits right after targetted commits, and mark them for merge (fixup)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Source : <a href="https://git-scm.com/docs" class="bare">https://git-scm.com/docs</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_windows_users">1.1.2. Windows users</h4>
<div class="paragraph">
<p>Git is aware of files execution bit (<code>chmod +x</code>).<br>
As <strong>Windows</strong> does not handle file permission Unix does, it is recommended to disable this awareness with <code>git config core.fileMode false</code>.<br>
To explicitly set a file as executable from Git perspective: <code>git update-index --chmod=+x &lt;file&gt;</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_git_concepts">1.2. Git concepts</h3>
<div class="paragraph">
<p><strong>Remotes</strong> are git repositories located in remote servers.<br>
The default remote is called <strong>origin</strong>.<br>
When a local repository has been cloned (hence, not initialized), <strong>origin</strong> targets the URL used at the time of the clone operation.</p>
</div>
<div class="paragraph">
<p>Git stores its data in a specific directory (<strong>.git</strong>), which contains the graph of all revisions of all branches, local and remote.<br>
Remote branches are available through their local name: <strong>&lt;remote_name&gt;/&lt;branch_name&gt;</strong>.<br>
For example, <strong>origin/main</strong> is the branch <strong>main</strong> as seen by the <strong>origin</strong> server when the last synchronisation (<code>git fetch</code>) was done.<br>
It is quite usual to have one (and one only) local version of a branch, and one more remote branches with different versions.<br>
It is only when a push will be done to a specific remote that these versions will match.<br>
Deleting the <strong>.git</strong> directory will permanently erase all revisions that have not been pushed to a remote.</p>
</div>
<div class="paragraph">
<p>The <strong>working copy</strong> is all the files in the local repository (expect for the <strong>.git</strong> directory).<br>
Modification, creation or deletion of these files can be done without alter revisions known to Git.<br>
In any case, Git can restore the previous state of the working copy as long as this state is recorded as a commit.</p>
</div>
<div class="paragraph">
<p>In order to <em>commit</em> modifications of the <strong>working copy</strong>, they must be indexed.<br>
The <strong>index</strong> allows to select only some files (and not others) when creating a commit.<br>
Files can be added, with the <code>add</code> command, or removed, with the <code>reset</code> command.<br>
The <code>status</code> command displays in different colors current changes, in green the indexed files, in red, the others.<br>
Performing a commit will consider all files displayed in green.</p>
</div>
<div class="sect3">
<h4 id="_rebase">1.2.1. Rebase</h4>
<div class="paragraph">
<p>The rebase is one of the feature that place Git way ahead of its predecessors.</p>
</div>
<div class="paragraph">
<p>It allows to update a branch with its remote state without complicated merge manual actions, as long as there no conflict requiring human oversight.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">git fetch --all --prune # <b class="conum">(1)</b>
git log --one-line -n 10 # <b class="conum">(2)</b>
git rebase origin/main # <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Get the latest version of all branches of the default remote (<strong>origin</strong>)</p>
</li>
<li>
<p>Display the last 10 commits of the current branch</p>
</li>
<li>
<p>Modify the history of the current branch by moving commits done after the base after the last ones pushed on the <code>main</code> branch of the remote <strong>origin</strong></p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/git_rebase.png" alt="git rebase">
</div>
</div>
<div class="paragraph">
<p>The <strong>rebase</strong> command can also be used interactively to alter the local history of the current branch:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add changes in an exiting commit</p>
</li>
<li>
<p>Change the name or description of a commit</p>
</li>
<li>
<p>Merge several commits into one</p>
</li>
<li>
<p>Delete commits (discarding changes)</p>
</li>
<li>
<p>Change commits order</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Advice</div>
</td>
<td class="content">
Do not use rebase on a branch shared by more than one person. Especially the <code>main</code> branch.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maven">1.3. Maven</h3>
<div class="paragraph">
<p>Maven is a build automation tool, for JVM-based projects.</p>
</div>
<div class="paragraph">
<p>It handles, among other functionalities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dependency management</p>
</li>
<li>
<p>Source code compilation</p>
</li>
<li>
<p>Tests execution</p>
</li>
<li>
<p>Documentation generation</p>
</li>
<li>
<p>Packaging of binaries</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s plugin-based system allows to adapt to various languages (Java, Scala, Kotlin, etc.) as well as different contexts (Continuous Integration, code generation, deployment, etc.).</p>
</div>
<div class="sect3">
<h4 id="_project_structure">1.3.1. Project structure</h4>
<div class="paragraph">
<p>A Maven project is organized by convention (over configuration) to avoid re-define standard parts, such as: source code, tests, etc.</p>
</div>
<div class="paragraph">
<p>A the root of a Maven project, we found:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A pom.xml file which contains all information needed for Maven to build the project. Its minimal content is as follow:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 1. File pom.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;project xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"
         xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.mycompany&lt;/groupId&gt; &lt;!--<b class="conum">(1)</b>--&gt;
    &lt;artifactId&gt;my-app&lt;/artifactId&gt;
    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;

    &lt;properties&gt; &lt;!--<b class="conum">(2)</b>--&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The tuple <code>groupId</code>, <code>artifactId</code> et <code>version</code> are the coordinates which identifies one Maven project and allows referencing it from others.</p>
</li>
<li>
<p>Optional section, here fixing the encoding and Java version to avoid conflicts later on</p>
</li>
</ol>
</div>
<div class="ulist">
<ul>
<li>
<p>A <strong>src</strong> directory which will contains all files we want to keep in the SCM</p>
<div class="ulist">
<ul>
<li>
<p>In <strong>src</strong>, there is standardly two directories: <strong>main</strong> et <strong>test</strong> which respectively contain production code, and test code (code not included in binaries produced during the <strong><em>packaging</em></strong> phase)</p>
<div class="ulist">
<ul>
<li>
<p>In each of these two directories, a directory named after the language used exists, in this exemple: <strong>java</strong>, but can be <strong>groovy</strong>, <strong>kotlin</strong>, etc.</p>
<div class="ulist">
<ul>
<li>
<p>Finally, in these directories, we put the code. This code is organized in packages, being themselves composed of directories</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/maven_structure.png" alt="maven structure">
</div>
<div class="title">Figure 1. Structure of a Maven project</div>
</div>
</div>
<div class="sect3">
<h4 id="_lifecycle_of_a_maven_project">1.3.2. Lifecycle of a Maven project</h4>
<div class="paragraph">
<p>By default, Maven uses a lifecycle which allows a majority of projects to be built with minimal configuration.</p>
</div>
<div class="paragraph">
<p>The main <strong>phases</strong> are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>clean</strong> : delete all created / generated files</p>
</li>
<li>
<p><strong>compile</strong> : compile <em>main</em> sources</p>
</li>
<li>
<p><strong>test-compile</strong> : compile <em>test</em> sources</p>
</li>
<li>
<p><strong>test</strong> : run tests</p>
</li>
<li>
<p><strong>package</strong> : create the binary archive (<strong>jar</strong> by default)</p>
</li>
<li>
<p><strong>install</strong> : copy the binary archive in the local Maven repository</p>
</li>
<li>
<p><strong>deploy</strong> : copy the binary archive in a distant Maven repository</p>
</li>
<li>
<p><strong>site</strong> : generate the documentation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each phase can be associated to one or more <strong>plugins</strong>, which makes Maven very extensive.</p>
</div>
<div class="paragraph">
<p>The default associations are:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/maven_circle.png" alt="maven circle">
</div>
</div>
<div class="paragraph">
<p>Some plugins are supplied by the Maven team, as the <strong>maven-clean-plugin</strong>, which deletes all generated files.</p>
</div>
<div class="paragraph">
<p>Others are created by the community, and do not require evolution in Maven itself. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>cukedoctor-maven-plugin</strong> : create an HTML report of Cucumber tests execution</p>
</li>
<li>
<p><strong>checkstyle-maven-plugin</strong> : statically analyze the code, and fail the build in case of a rule violation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Source : <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html" class="bare">https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_tags">1.3.3. Configuration tags</h4>
<div class="paragraph">
<p>All tags must be contained in the <code>&lt;project&gt;</code> bloc.</p>
</div>
<div class="paragraph">
<p>Among the most used tags, there is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>properties</code>: this tag contains key-value pairs, which can be used later on, either by convention by plugins, or explicitly using a language expression <code>${my-property}</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;properties&gt;
    &lt;my-test-lib.version&gt;1.2&lt;/my-test-lib.version&gt;
&lt;/properties&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dependencies</code>: this tag contains all dependencies used tin the project. A dependency can be a sibling module or and external library available from a remote repository.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt; &lt;!--<b class="conum">(1)</b>--&gt;
        &lt;groupId&gt;com.mycompany&lt;/groupId&gt;
        &lt;artifactId&gt;my-lib&lt;/artifactId&gt;
        &lt;version&gt;1.45.3&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.mycompany&lt;/groupId&gt;
        &lt;artifactId&gt;my-test-lib&lt;/artifactId&gt;
        &lt;version&gt;${my-test-lib.version}&lt;/version&gt; &lt;!--<b class="conum">(2)</b>--&gt;
        &lt;scope&gt;test&lt;/scope&gt; &lt;!--<b class="conum">(3)</b>--&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>dependencies</code> bloc is composed of <code>dependency</code> (singular) blocs, each containing the coordinates of one dependency</p>
</li>
<li>
<p>The version value references the <code>my-test-lib.version</code> property, therefore <code>1.2</code></p>
</li>
<li>
<p>This second dependency has the <code>test</code> <strong><em>scope</em></strong>, hence this dependency is only available for test code</p>
</li>
</ol>
</div>
<div class="ulist">
<ul>
<li>
<p><code>build/plugins</code>: this tag contains all plugins used by the project as well as their configurations</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt; &lt;!--<b class="conum">(1)</b>--&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;!--<b class="conum">(2)</b>--&gt;
            &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
            &lt;version&gt;2.22.2&lt;/version&gt;
            &lt;configuration&gt; &lt;!--<b class="conum">(3)</b>--&gt;
                &lt;failIfNoTests&gt;true&lt;/failIfNoTests&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>As for the <code>dependencies</code> tag, the <code>plugins</code> one contains <code>plugin</code> (singular) blocs</p>
</li>
<li>
<p>Here the <code>maven-surefire-plugin</code> plugin is used. It is the default plugin for executing tests. By adding this bloc, the version is fixed and the configuration overridden. A plugin is a Maven project, and as such, has coordinates like dependencies</p>
</li>
<li>
<p>The <code>configuration</code> tag allows to change the default behavior of the plugin. Here the project build will fail if no test is found</p>
</li>
</ol>
</div>
<div class="ulist">
<ul>
<li>
<p><code>profiles</code>: this tag allow to add configuration fragments that can be activated/ deactivated at will, without changing the project. A profile may add <code>properties</code>, <code>dependencies</code>, <code>plugins</code> and even <code>modules</code> (used in multi-modules project)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;profiles&gt;
    &lt;profile&gt;
        &lt;id&gt;disable-tests&lt;/id&gt; &lt;!--<b class="conum">(1)</b>--&gt;
        &lt;properties&gt;
            &lt;maven.test.skip&gt;true&lt;/maven.test.skip&gt;
        &lt;/properties&gt;
    &lt;/profile&gt;
&lt;/profiles&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Mandatory tag, a profile must have an ID, used to activate it from the command line. For example: <code>mvn install -P disable-tests</code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_junit">1.4. JUnit</h3>
<div class="paragraph">
<p>Java does not supply a built-in tool or API to describe or run tests.</p>
</div>
<div class="paragraph">
<p>Maven supply a dedicated directory, phases (compilation &amp; execution), and a scope to handle this code which is not going into production.<br>
However, Maven does not supply either tool or API to describe and execute these tests.</p>
</div>
<div class="paragraph">
<p>This is where <em>test frameworks</em> come in.<br>
There are several of them, and JUnit is the most used today in the Java world.</p>
</div>
<div class="sect3">
<h4 id="_utilisation_of_junit_jupiter_api">1.4.1. Utilisation of JUnit-Jupiter API</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class CalculatorTest {

    private final Calculator calculator = new Calculator();

    @Test // <b class="conum">(1)</b>
    void simple_division() {
        int result = calculator.divide(8).by(2); // <b class="conum">(2)</b>

        Assertions.assertThat(result) // <b class="conum">(3)</b>
            .as("division of 8 by 2")
            .isEqualTo(4); // <b class="conum">(4)</b>
    }

    @Test
    void division_by_zero_should_throw() {
        Assertions.assertThatExceptionOfType(IllegalArgumentException.class) // <b class="conum">(5)</b>
            .isThrownBy(() -&gt; calculator.divide(3).by(0)) // <b class="conum">(6)</b>
            .withMessage("Cannot divide by zero"); // <b class="conum">(7)</b>
    }

    @ParameterizedTest // <b class="conum">(8)</b>
    @CsvSource({
        "0, 3, 3",
        "3, 4, 7"
    }) // <b class="conum">(9)</b>
    void addition_cases(int a, int b, int expectedResult) { // <b class="conum">(10)</b>
        int result = calculator.add(a).and(b);

        Assertions.assertThat(result) // <b class="conum">(3)</b>
            .as("addition of " + a + " and " + b)
            .isEqualTo(expectedResult);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Method mark as a test one, because annotated with <code>org.junit.jupiter.api.Test</code></p>
</li>
<li>
<p>Trigger event, some <em>main</em> code is executed</p>
</li>
<li>
<p>The result of the main code call is checked (here with the <strong>AssertJ</strong> library)</p>
</li>
<li>
<p>These three lines compose a single expression, as the compiler ignores line breaks. This kind of writing is called <strong>fluent interface</strong> and is built on consecutive method calls in such as way that they compose a meaningful sentence. Here, literally: check that the <code>result</code> variable as the "division of 8 by 2" is equal to 4</p>
</li>
<li>
<p>Check that an error is produced. This test will break if no error is produced or if the type of the error is different from the one expected</p>
</li>
<li>
<p>A function is given to the assertion API, it will be executed by the library, in a <code>try / catch</code> bloc</p>
</li>
<li>
<p>Check of the error message, if the message does not match the expected one, the test will fail</p>
</li>
<li>
<p>Method marked as a parameterized test, it will be executed as many times as there are test cases. In this example, the method will be executed twice</p>
</li>
<li>
<p>The dataset, here supplied as inlined CSV (Comma Separated Values), other sources may be used</p>
</li>
<li>
<p>Method parameters must match those in a test case, and follow the same order.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_how_junit_works_with_maven">1.4.2. How JUnit works with Maven</h4>
<div class="paragraph">
<p><strong>JUnit-Jupiter</strong> is composed of several parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An API to describe test methods (<code>@Test</code>, etc.)</p>
</li>
<li>
<p>An execution engine which is able to detect and run test methods</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JUnit also supplies a launcher of execution engine: <strong>junit-platform-launcher</strong></p>
</div>
<div class="paragraph">
<p>Finally, the <strong>maven-surefire-plugin</strong> plugin "knows" how to connect (among other tools) to this  <em>launcher</em> (since version 2.22.0).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To summarize :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>test</strong> phase of Maven is associated to the <strong>maven-surefire-plugin</strong> plugin</p>
</li>
<li>
<p>This plugin can run <strong>junit-platform-launcher</strong> (if this library is available in the <em>classpath</em>)</p>
</li>
<li>
<p>This <em>launcher</em> can run execution engines built with the <strong>junit-platform-engine</strong> API, <strong>JUnit-Jupiter</strong> being one of them</p>
</li>
<li>
<p><strong>JUnit-Jupiter</strong> can detect and run tests described with its API</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_a_story_about_junit">1.4.3. A story about JUnit</h4>
<div class="paragraph">
<p>JUnit is an old framework (1997) and has evolved a lot through Java versions.<br>
The version 4, released in 2006 (after Java 1.5), has been broadly adopted and used during a long time, due to its simplicity using annotations (<code>@Test</code>).<br>
In 2015, a crowdfunding campaign is launched to create JUnit5, a complete rewriting of the framework.</p>
</div>
<div class="paragraph">
<p>Right from the start, the team choose to create modular and dedicated APIs to avoid the same slides in the previous API, which was both very permissive and very complicated.</p>
</div>
<div class="paragraph">
<p>This was due to the initial API being designed to mark test methods, but evolved to allow plugins to describe tests arbitrarily (Cucumber, etc.) where a test can be a paragraph in a text file.</p>
</div>
<div class="paragraph">
<p>Furthermore, even if there was several extension points in version 4, the most used was <code>Runner</code>, which could not be composed.<br>
This lead plugin teams to supply tools available from several extension points (<code>Runner</code>, <code>Rule</code>, initialization in <code>setUp</code> method, etc.) to bypass this flaw.</p>
</div>
<div class="paragraph">
<p>JUnit5 team stated that each paradigm should have its own API and execution engine, so that the code can be more specific, and much simple.</p>
</div>
<div class="paragraph">
<p>The resulting architecture is:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/junit5_architecture.png" alt="junit5 architecture">
</div>
</div>
<div class="paragraph">
<p><strong>JUnit-platform</strong> is a framework to build and run execution engines.</p>
</div>
<div class="paragraph">
<p><strong>JUnit-Vintage</strong> is an execution engine compatible with JUnit4 API.</p>
</div>
<div class="paragraph">
<p><strong>JUnit-Jupiter</strong> is an execution engine with a new API which offers multiple and composable extension points.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_low_coupling_a_target_at_each_scale">2. Low coupling, a target at each scale</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
I answered their issue by offering to add a new layer of indirection.
</blockquote>
<div class="attribution">
&#8212; some architect passing by
</div>
</div>
<div class="paragraph">
<p>In most situations, the most important objective is <strong>maintainability</strong>, as software is built to last for a long time.<br>
In case of an issue, link to performance, security, or normal operation, the solution must aim to have the minimum impact.<br>
Bigger is the code change, bigger is the risk to broke something else and longer is the time before deploying the change.<br>
A fix or an evolution, must have the least risk possible.</p>
</div>
<div class="paragraph">
<p>Reducing the time between the design of a new feature and its delivery to production, is increasing the mastery and confidence of the team producing code the code.</p>
</div>
<div class="sect2">
<h3 id="_at_a_java_class_scale">2.1. At a Java class scale</h3>
<div class="sect3">
<h4 id="_example_1_internal_state_vs_public_contract">2.1.1. Example 1: Internal state vs public contract</h4>
<div class="paragraph">
<p>Consider this class:</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. File TrafficLight.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class TrafficLight {

    private int color;

    public void setColor(int newColor) {
        this.color = newColor;
    }

    public int getColor() { // <b class="conum">(1)</b>
        return color;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Changing the type of internal state representation (<code>int</code>) will need to adapt the code using this class</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The class could be rewritten to <span class="underline">uncouple</span>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the internal state, represented by an <code>int</code></p>
</li>
<li>
<p>the <code>public</code> contract (API) callable by other classes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 3. File TrafficLight.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class TrafficLight {

    private int color;

    public Color nextState() {
        color = (color + 1) % 3;
        return Color.values()[color];
    }

    public enum Color {
        GREEN,
        ORANGE,
        RED,
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_2_positional_coupling_of_parameters">2.1.2. Example 2: Positional coupling of parameters</h4>
<div class="paragraph">
<p>Consider this interface:</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. File PersonRepository.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">interface PersonRepository {

    void savePerson(String firstname, String lastname, int birthYear, int birthMonth);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When calling this method, one may invert one parameter with another of the same type without noticing it.<br>
Here the compilation will not help detect a bug, where month and year are inverted for example.<br>
This is called <em>positional coupling</em>.<br>
A better design could be:</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. File PersonRepository.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">interface PersonRepository {

    Person savePerson(Person person);

    @RecordBuilder // <b class="conum">(1)</b>
    record Person(String firstname, String lastname, YearMonth birthMonth) {}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <strong>io.soabase.record-builder:record-builder</strong> library is used to generate the matching <em>builder</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is now harder to make a mistake:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Person person = PersonBuilder.builder()
    .firstname("Bobby")
    .lastname("Singer")
    .birthMonth(YearMonth.of(1962, Month.DECEMBER))
    .build();

repository.savePerson(person);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_3_public_contract_extracted_in_an_interface">2.1.3. Example 3: Public contract extracted in an interface</h4>
<div class="paragraph">
<p>The point of using interfaces is to uncouple the public contract from the concrete implementation.<br>
This allows to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Substitute one type by another (implementing the same interface) without modifying the calling code</p>
</li>
<li>
<p>Hide the implementation (methods and fields missing from the interface) from the calling code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>Logger</code> concept, widely used in IT, is an abstraction to send events <em>somewhere</em>.<br>
From the perspective of the business code, it does not matter where events are sent.</p>
</div>
<div class="paragraph">
<p>This abstraction is an interface, for example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. File Logger.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">interface Logger {

    void log(Level level, String message);

    enum Level {
        INFO,
        WARNING,
        ERROR,
        ;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And can be used this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">record CoffeeShop(CoffeeMaker coffeeMaker, Logger logger) {

    public Cup makeCoffee(String firstname) {
        if(!coffeeMaker.isReady()) {
            logger.log(Level.WARN, "Tried to make some coffee, but the coffee maker is not ready yet");
            return Cup.EMPTY;
        }
        Cup cup = new Cup(firstname);
        coffeeMaker.pourIn(cup);
        logger.log(Level.INFO, "Made coffee for " + firstname + ", careful itâs hot !");
        return cup;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using an implementation of <code>Logger</code> which writes in</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The standard output</p>
</li>
<li>
<p>A file</p>
</li>
<li>
<p>A database</p>
</li>
<li>
<p>A message broker</p>
</li>
<li>
<p>A composition of all of the above</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>will not change the code of the <code>CoffeeShop</code> class.</p>
</div>
</div>
<div class="sect3">
<h4 id="_various_forms_of_coupling">2.1.4. Various forms of coupling</h4>
<div class="paragraph">
<p>Various forms of coupling can be found here: <a href="https://connascence.io/" class="bare">https://connascence.io/</a></p>
</div>
<div class="paragraph">
<p>Most of couplings can be avoided by using the code at the moment of its creation.<br>
The simplest technic is follow the <strong>TDD</strong> (Test Driven Development) principles.</p>
</div>
<div class="paragraph">
<p>Practicing <strong>TDD</strong> involves writing a <em>minimalist</em> test before writing the <em>minimalist</em> production code that makes it pass.<br>
Code written this way, strictly meeting test requirements, is by design easily usable (as already used in tests).</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>1) Write <span class="underline">NO</span> production code except to pass a failing test<br>
2) Write only <span class="underline">enough</span> of a test to demonstrate a failure<br>
3) Write only <span class="underline">enough</span> production code to pass the test</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Robert "Uncle Bob" Martin<br>
<cite>Three laws of TDD</cite>
</div>
</div>
<div class="paragraph">
<p>Writing <em>minimalist</em> tests is very important, as we want, when practicing <strong>TDD</strong>, shorten to the maximum the feedback loop between phases:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/tdd_red_green_blue.png" alt="tdd red green blue">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_at_an_application_scale">2.2. At an application scale</h3>
<div class="sect3">
<h4 id="_business_low_coupling">2.2.1. Business low coupling</h4>
<div class="paragraph">
<p>An application uses most of the time distinct business domains.</p>
</div>
<div class="paragraph">
<p>For example, in an e-commerce application, we find catalog management, product sheet, cart detail, payment, invoicing, etc.</p>
</div>
<div class="paragraph">
<p>These domains are connected, but can evolve separately from each others.<br>
Code must express these connections, but also the self-sufficiency.<br>
A modification in the cart detail code will not (or should not) need another modification in the payment code.</p>
</div>
<div class="paragraph">
<p>Maintaining a low coupling between applicative components reduce the risk of introducing a bug in case of a change.</p>
</div>
</div>
<div class="sect3">
<h4 id="_technical_low_coupling">2.2.2. Technical low coupling</h4>
<div class="paragraph">
<p>The same way, splitting business code (containing business rules) and technical code is a good approach.<br>
What is meant by <em>technical code</em> is code needed to connect to the outside world, typically by way of an</p>
</div>
<div class="ulist">
<ul>
<li>
<p>API</p>
</li>
<li>
<p>Graphical user interface</p>
</li>
<li>
<p>Connection to a message broker</p>
</li>
<li>
<p>Connection to a database</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The core code of an application can be built without any framework or library in order to simplify tests and reduce the business code to its simplest form.</p>
</div>
<div class="paragraph">
<p><em>Connectors</em> can later on be wired to it, to bridge business rules to other systems of users.</p>
</div>
<div class="paragraph">
<p>One of these approach is <span class="underline">hexagonal architecture</span>, which will be detailed in the next chapters.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_at_an_information_system_scale">2.3. At an information system scale</h3>
<div class="paragraph">
<p>In an information system, multiple applications, maintained by distinct teams must exchange data.</p>
</div>
<div class="paragraph">
<p>Architectural decisions choosen at this scale must consider the objectives previously enumerated (Maintainability, Testability, etc.) as well as the human factor.</p>
</div>
<div class="paragraph">
<p>Teams working on different applications are made of men and women with different work habits, rhythms and technical maturity.</p>
</div>
<div class="paragraph">
<p>It is necessary to consider these elements to protect the quality of service and simplify interactions between teams.</p>
</div>
<div class="sect3">
<h4 id="_example_1_asynchronous_communication">2.3.1. Example 1: asynchronous communication</h4>
<div class="paragraph">
<p>Consider an application under heavy but irregular traffic, as a website performing mortgage simulations which is mainly used between 12 P.M. and 2 P.M.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/mortgage_system_http.png" alt="mortgage system http">
</div>
</div>
<div class="paragraph">
<p>The public website gathers simulation requests and sends them to an internal service which perform these tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connect periodically to external APIs of various banks to maintain fresh data for computation</p>
</li>
<li>
<p>Compute the simulations (we imagine them slow for the sake of the demonstration) based on user request information</p>
</li>
<li>
<p>Send back simulation results to the public website</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even with a low traffic, a service interruption of a few minutes can damage the business, by loosing customers or visibility.</p>
</div>
<div class="paragraph">
<p>However with a synchronous communication between the public website and the internal service, an update of the latter will <em>de facto</em> lead to the public website service interruption or data loss.</p>
</div>
<div class="paragraph">
<p>In this case, it is relevant to switch the communication model to an asynchronous one, through a message broker which will buffer user requests.<br>
Thus, no service interruption will be <em>visible</em> and no data will be be lost.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/mortgage_system_amqp.png" alt="mortgage system amqp">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_2_spread_the_load">2.3.2. Example 2: spread the load</h4>
<div class="paragraph">
<p>Following on from the same mortgage application, consider that the message broker is coupled to the internal service for legacy reasons.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/mortgage_system_bad_bad_jms.png" alt="mortgage system bad bad jms">
</div>
</div>
<div class="paragraph">
<p>Sending a lot of events all at once (water hammer) to such a system could reduce its performance, or even crash it.</p>
</div>
<div class="paragraph">
<p>In this case, it could be simpler to have the publishing application to spread the load (<em>throttling</em>), to avoid the pressure coupling between the two applications.</p>
</div>
<div class="paragraph">
<p>Setting up this kind of mechanism requires to define a maximum speed (in messages/sec for example).<br>
It can be built using different solutions, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Periodically read the X oldest messages in a database (be careful however, batch systems are difficult to scale)</p>
</li>
<li>
<p>A small dedicated application using off-memory state (database, to be able to simply scale if needed)</p>
</li>
<li>
<p>Using some brokers functionalities</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common_architecture_styles">3. Common architecture styles</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Any organization that designs a system (defined broadly) will produce a design whose structure is a copy of the organization&#8217;s communication structure.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; attributed to Melvin Conway<br>
<cite>Conway's Law</cite>
</div>
</div>
<div class="paragraph">
<p>Everything has a cost, development itself is often the highest one.</p>
</div>
<div class="paragraph">
<p>Architecture choices should tend toward matching development cost and expected gain, hence it is strategic for a company.</p>
</div>
<div class="paragraph">
<p>Behind the mercantile facet, it is more pleasant to add new features on top of a good code base, rather than waiting for another team to deploy a new version of some API our team needs, or even be buried under constant bug-bashing.</p>
</div>
<div class="paragraph">
<p>Architecture decisions are relevant in the context of development iterations, in order to focus energy on added value at the time being.</p>
</div>
<div class="sect2">
<h3 id="_n_tier">3.1. N-tier</h3>
<div class="paragraph">
<p>N-tier architecture divides an application into technical layers.</p>
</div>
<div class="paragraph">
<p>For a simple application (HTTP API on one side, some database on the other for example), we often find <strong>3</strong> tiers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <span class="underline">Controller</span> layer, responsible for</p>
<div class="ulist">
<ul>
<li>
<p>HTTP transport</p>
</li>
<li>
<p>Securing the access (Authentication and Authorization)</p>
</li>
<li>
<p>Serializing and deserialize data into <em>anemic</em> objects (<strong>D</strong>ata <strong>T</strong>ransfer <strong>O</strong>bject)</p>
</li>
<li>
<p>Performing surface validation, particularly on received data structure</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <span class="underline">Service</span> layer, responsible for</p>
<div class="ulist">
<ul>
<li>
<p>Supplying high-level business features to <em>controllers</em>, so no business logic leak into this other layer</p>
</li>
<li>
<p>Ensuring data consistency, in regard to <em>business rules</em></p>
</li>
<li>
<p>(Handle transactions , if the database is transactional)</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <span class="underline">Persistence</span> layer (aka <em>repositories</em>, or <strong>D</strong>ata <strong>A</strong>ccess <strong>O</strong>bjects), responsible for</p>
<div class="ulist">
<ul>
<li>
<p>Communicating with the database</p>
</li>
<li>
<p>Serializing and deserialize data into <em>anemic</em> objects (<strong>D</strong>ata <strong>T</strong>ransfer <strong>O</strong>bject or entities)</p>
</li>
<li>
<p>Translate database technical errors to be handled by a business rule in the <em>service</em> layer</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/n_tiers.png" alt="n tiers">
</div>
</div>
<div class="paragraph">
<p>This architecture style is often applied as-is to the entire code base, and brings confusion when it comes to understanding the different business domains.</p>
</div>
<div class="paragraph">
<p>It would be preferable to introduce a division <em>matching</em> business domains</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/n_tiers_tree_lvl1.png" alt="n tiers tree lvl1">
</div>
</div>
<div class="paragraph">
<p>That way, understanding of the key domains of an application is simpler, and it avoids to mix by mistake components between domains.</p>
</div>
<div class="paragraph">
<p>Furthermore, code can still be divided in technical layers inside each domain.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/n_tiers_tree_lvl2.png" alt="n tiers tree lvl2">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hexagonal">3.2. Hexagonal</h3>
<div class="paragraph">
<p><strong>Hexagonal architecture</strong> aim for dividing <em>business code</em> from <em>technical code</em>.</p>
</div>
<div class="paragraph">
<p>The division isolates the application <em>core</em>, from the <em>adapters</em> which link <em>business code</em> to the outside world, <em>machine-to-machine</em> communication (HTTPS, AMQP, etc.), or <em>human-to-machine</em> (GUI, email, SMS, etc.)</p>
</div>
<div class="paragraph">
<p>The objectives are as follow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maintain a low coupling between technical stakes and business rules</p>
</li>
<li>
<p>Simplify tests on the <em>business code</em>, since there is no framework or library involved</p>
</li>
<li>
<p>Allow to replace one <em>adapter</em>, without modifying the rest of the application</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/hexagonal_architecture.png" alt="hexagonal architecture">
</div>
</div>
<div class="paragraph">
<p>Some vocabulary:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>API</strong> (<strong>A</strong>pplication <strong>P</strong>rogramming <strong>I</strong>nterface) an interface which is <span class="underline">implÃ©mented by the business code</span>, and called by an adapter</p>
</li>
<li>
<p><strong>SPI</strong> (<strong>S</strong>ervice <strong>P</strong>rovider <strong>I</strong>nterface) an interface which is called by the business code, and <span class="underline">implemented by an adapter</span>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Development starts by writing the business code of a feature.<br>
This code must not use any dependency to a framework or library.<br>
To this end, this code can be isolated in a dedicated module so that the compilation can enforce this no-dependency rule.</p>
</div>
<div class="paragraph">
<p>Afterwards, other modules can be added for adapters, these modules having a dependency to the core one.</p>
</div>
</div>
<div class="sect2">
<h3 id="_monolith_vs_micro_services">3.3. Monolith vs micro-services</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Iâll keep saying this&#8230;&#8203; if people canât build monoliths properly, microservices wonât help.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Simon Brown<br>
<cite>@simonbrown</cite>
</div>
</div>
<div class="paragraph">
<p>Building a monolith is creating one only application to handle all features.</p>
</div>
<div class="paragraph">
<p>In a monolith, modularize the code to isolate parts of the code that must not interact with each other is vital.</p>
</div>
<div class="paragraph">
<p>If not followed, the risk is to see an exponential growth of the complexity emerging at each feature addition.</p>
</div>
<div class="paragraph">
<p>On the other hand, the micro-service architecture style forces a kind of division, as micro-services must not depend (in terms of code) to each other.<br>
Lâapproche micro-service a ceci de diffÃ©rent que les diffÃ©rents domaines sont gÃ©rÃ©s par des applications diffÃ©rentes.<br>
As it is still possible to share code trough the use of shared libraries, domain isolation, as in a monolith, is essential.<br>
The rule that expresses this concern the most is that each micro-service must have (if needed) its own database / data persistence model.</p>
</div>
<div class="paragraph">
<p>The same way, if micro-services must communicate, using asynchronous communication will avoid time-related coupling.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/micro_services_ecommerce.png" alt="micro services ecommerce">
</div>
</div>
<div class="paragraph">
<p>A micro-services architecture has downsides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Multiple applications must be deployed at a fast pace</p>
<div class="ulist unstyled">
<ul class="unstyled">
<li>
<p>&#8594; Delivery and deployment must be robust and automated</p>
</li>
</ul>
</div>
</li>
<li>
<p>Issue investigation is more complex, as a single user action can be spread across multiple applications</p>
<div class="ulist unstyled">
<ul class="unstyled">
<li>
<p>&#8594; Logs must be unique, informative and centralized</p>
</li>
<li>
<p>&#8594; A correlation mechanism is needed (correlation-id header, via header, APM, etc.)</p>
</li>
</ul>
</div>
</li>
<li>
<p>The infrastructure cost is higher</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And upsides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The code of one micro-service is smaller, simpler</p>
</li>
<li>
<p>Micro-services can evolve independently of each other, and be maintained by different teams</p>
</li>
<li>
<p>Micro-services can scale separately from each other</p>
<div class="ulist unstyled">
<ul class="unstyled">
<li>
<p>&#8594; If the <em>product</em> domain of an e-commerce website is under more load than the <em>payment</em> one, it is possible to dispatch more resources to the one needing it</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scaling_relative_considerations">4. Scaling &amp; relative considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some time ago, the habit of building monolithic applications with in-memory state (such applications are said <em>stateful</em>) needed more powerful servers to follow an increase in usage.</p>
</div>
<div class="paragraph">
<p>What needed to be increased:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RAM (memory)</p>
</li>
<li>
<p>CPU frequency</p>
</li>
<li>
<p>Number of CPU cores</p>
</li>
<li>
<p>Disk size</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Such upgrades fall under <strong>vertical scaling</strong>.<br>
However hardware prices are not proportional to power, but rather exponential.<br>
This scaling type rapidly faces technical limit (maximum power of a CPU at a certain time) or financial limit.</p>
</div>
<div class="paragraph">
<p>Some systems, such as traditional SQL databases (Oracle, PostgreSQL, MySql, etc.) hav no choice but to use this kind of scaling.</p>
</div>
<div class="paragraph">
<p>Conversely, applications can be structured in a way that they can be scaled differently.</p>
</div>
<div class="paragraph">
<p>In this case, <strong>horizontal scaling</strong>, which involves adding more containers / VMs / serveurs to increase the system capacities in a <strong>linear</strong> way.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/vertical_vs_horizontal_scaling.png" alt="vertical vs horizontal scaling">
</div>
</div>
<div class="paragraph">
<p>Another downside of having a unique instance, is that any change needing a reboot (configuration, new version, etc.) will interrupt the service.</p>
</div>
<div class="paragraph">
<p>Whereas with several instances of the same service, rebooting one is transparent from the user perspective.</p>
</div>
<div class="paragraph">
<p>Rebooting all instances, each one at a time, is called <strong>rolling update</strong> and used to update an application without service interruption.</p>
</div>
<div class="paragraph">
<p>The only warning with such a system, is to pay attention to N-1 retro-compatibility, as during an update, both versions, the old one and the new one, will run behind the same load-balancer at some point.<br>
So API of the old version must have the same contracts and behave the same when used on the new version.</p>
</div>
<div class="sect2">
<h3 id="_identify_spofs">4.1. Identify SPOFs</h3>
<div class="paragraph">
<p>SPOFs (<strong>S</strong>ingle <strong>P</strong>oint <strong>O</strong>f <strong>F</strong>ailure), are parts of a system that cannot have more than one instance and by design lead to service interruption in case of a stop (crash, update, etc.).</p>
</div>
<div class="paragraph">
<p>It is important to have monitoring on these components in order to rapidly take action in case of an issue.</p>
</div>
<div class="paragraph">
<p>This reaction can be automated (switch to a replica, passive until then) or manual.</p>
</div>
<div class="paragraph">
<p>Knowing where SPOFs are, can also orient the system architecture to avoid flooding these components by setting up throttling or caching.</p>
</div>
<div class="paragraph">
<p>SQL databases are often SPOFs; but most of them have replication mechanisms capable of keeping several other instances up-to-date and ready to use if the main one fails.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/pg_auto_failover.png" alt="pg auto failover">
</div>
<div class="title">Figure 2. PostgreSQL replica switch mechanism (<code>pg_auto_failover</code>)</div>
</div>
</div>
<div class="sect2">
<h3 id="_identify_points_of_contention">4.2. Identify points of contention</h3>
<div class="paragraph">
<p>When a system is under heavy load, points of contention may appear.</p>
</div>
<div class="paragraph">
<p>We are talking about parts of the system with slower processing which defines the maximum speed of the overall system.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Like with a stormwater run-off system, if one of the pipe has a low throughput, the whole system appears slow, risking congestion
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A point of contention can induce cascading reactions or hide several other contentions.</p>
</div>
<div class="paragraph">
<p>To identify and improve them if necessary, a precise supervision of each components of the system is required.<br>
Supervision consists, among other things, of a probe set which collect data periodically so they can be graphed.<br>
These graphs reflect the system evolution over time and allow to make correlations between exogenous events and endogenous consequences.</p>
</div>
</div>
<div class="sect2">
<h3 id="_distribute_the_load">4.3. Distribute the load</h3>
<div class="sect3">
<h4 id="_for_synchronous_communications">4.3.1. For synchronous communications</h4>
<div class="paragraph">
<p>To distribute the load on multiple instances of a same service, we use load-balancers, whether they are hardware (F5, AltÃ©on, etc.) or software (HAProxy, Nginx, Traefik, etc.).</p>
</div>
<div class="paragraph">
<p>Multiple configurations are available, to weight target nodes or establish <em>sticky session</em>.</p>
</div>
<div class="paragraph">
<p>Software load-balancers are simpler to configure and can even be controlled through an API.<br>
This last capability allow to automate operations such as the previously mentioned <strong>rolling update</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_for_asynchronous_communications">4.3.2. For asynchronous communications</h4>
<div class="paragraph">
<p>When using asynchronous communication protocols, its is best to rely on a dedicated message broker which acts as a buffer between applications.</p>
</div>
<div class="paragraph">
<p>Several tools and mechanisms are available to make a broker <em><strong>H</strong>igh <strong>A</strong>vailability</em> and capable of ingesting large quantities of data.</p>
</div>
<div class="paragraph">
<p>Such a broker can ingest occasional pressure surges and damper them for listening applications.</p>
</div>
<div class="paragraph">
<p>When communicating asynchronously, using pull flow allow a listening application to consume events at its own pace.</p>
</div>
<div class="paragraph">
<p>Load distribution is available <em>by design</em> by adding more instances of listening applications.</p>
</div>
<div class="paragraph">
<p>Most brokers offer different delivery strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>at most once</strong>: in this case, events can be loss</p>
<div class="ulist">
<ul>
<li>
<p>Use case: notifications, data of little importance</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>at least once</strong>: in this case, events can be delivered more than once, listening applications must be able to behave in an idempotent way</p>
<div class="ulist">
<ul>
<li>
<p>Use case: every other cases, where loosing data is not an option (customer order, bank transaction, etc.)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_architecture_evolution_example">4.4. Architecture evolution example</h3>
<div class="paragraph">
<p>Consider a <em>typical</em> application such as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/korekto_context.png" alt="korekto context">
</div>
<div class="title">Figure 3. Context diagram</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/korekto_container_v0.png" alt="korekto container v0">
</div>
<div class="title">Figure 4. Container diagram</div>
</div>
<div class="sect3">
<h4 id="_introduction_of_a_load_balancer">4.4.1. Introduction of a load-balancer</h4>
<div class="paragraph">
<p>Horizontal scaling, is the ability to increase a system capacity by adding more instances (or nodes).<br>
But from the users perspective, there is only one service (<a href="https://korekto.io" class="bare">https://korekto.io</a> for example).<br>
To map from one service to multiple instances, we use a load-balancer.</p>
</div>
<div class="paragraph">
<p>Warning, the part that executes a task every 4 hours must only be active on one instance, under penalty of doing the same job multiple times, which can lead to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pointless CPU load</p>
</li>
<li>
<p>Incoherent data</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/korekto_container_v1.png" alt="korekto container v1">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_split_the_application">4.4.2. Split the application</h4>
<div class="paragraph">
<p>Some features are used less often and uses less CPU.<br>
It can be interresting to split our monolithic application into smaller ones, to be able to update them independently and scale them differently.<br>
This separation must respect one golden rule to be durable:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Applications must be independent technically AND logically (from a business perspective).</p>
</div>
<div class="paragraph">
<p>This means that if one application is to evolve, it can do so without impact to others.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/korekto_container_v2.png" alt="korekto container v2">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deleting_spofs">4.4.3. Deleting SPOFs</h4>
<div class="paragraph">
<p><strong>S</strong>ingle <strong>P</strong>oint <strong>O</strong>f <strong>F</strong>ailure are components of the system that cannot be replicated.<br>
This causes 2 issues:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the component stops working, it causes a service disruption</p>
</li>
<li>
<p>If the traffic increases, the only possibility is vertical scaling</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>SPOF nature is often due to a state stored in memory or a low latency storage need.<br>
This is the case of the <strong>[batch]</strong> component.</p>
</div>
<div class="paragraph">
<p>If multiple instances were to execute simultaneously, how could they synchronize to distribute the work and restart jobs of failing instances ?</p>
</div>
<div class="paragraph">
<p>In our case, the simplest move is to use GitHub webhooks to be notified in case of a change, rather than periodically scan for change.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/korekto_container_v3.png" alt="korekto container v3">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_do_not_exchange_data_through_storage">4.4.4. Do not exchange data through storage</h4>
<div class="paragraph">
<p>During the split, a mistake was made.<br>
Indeed, the <strong>[web]</strong> container and the <strong>[grader]</strong> one exchange data through the database.</p>
</div>
<div class="paragraph">
<p>This is well known anti-pattern, because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to change the database model without impact for both containers?</p>
</li>
<li>
<p>How to change the way data is stored without impact for both containers?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two containers are coupled.</p>
</div>
<div class="paragraph">
<p>The objective now, is to introduce a new container which will abstract the storage.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/korekto_container_v4.png" alt="korekto container v4">
</div>
</div>
<div class="paragraph">
<p>Therefore, when</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some of the data must be stored in a different way (in a relational database for example)</p>
<div class="ulist unstyled">
<ul class="unstyled">
<li>
<p>&#8594; the change occurs in one only container, the <strong>[storage API]</strong> one</p>
</li>
</ul>
</div>
</li>
<li>
<p>The exercise model evolves to include more data</p>
<div class="ulist unstyled">
<ul class="unstyled">
<li>
<p>&#8594; <strong>[storage API]</strong> supplies a new API (GET / POST / PUT / DELETE) <a href="#">/api/admin/specification/exercise/${name}/v2</a></p>
</li>
<li>
<p>&#8594; <strong>[web]</strong> may use this API so teachers can better define properties of an exercise</p>
</li>
<li>
<p>&#8594; <strong>[grader]</strong> may use this API to improve grading</p>
</li>
<li>
<p>&#8594; <strong>[storage API]</strong> may delete the old API (<a href="#">/api/admin/specification/exercise/${name}/v1</a>) when no container use it anymore</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>These kind of changes can be applied with no service disruption</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architectural_documentation">5. Architectural documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Documentation of an IT project was historically very verbose (Technical specifications, Functional specifications, <strong>T</strong>echnical <strong>A</strong>rchitecture <strong>D</strong>ocument, etc.)</p>
</div>
<div class="paragraph">
<p>Yet, an IT project evolves fast, faster than these documents.<br>
This documentation become rapidly outdated, and leads to confusion or bugs as some pieces of information are simply false?</p>
</div>
<div class="paragraph">
<p>However, documenting a project is necessary to pass on knowledge among changing stakeholders.</p>
</div>
<div class="paragraph">
<p>Hence, the objective is to write the minimum required to understand the context, and to hook this documentation up to code, as much as possible.</p>
</div>
<div class="paragraph">
<p>Thiw kind of documentation which has its roots in code is called living documentation, as it evolves naturally as the project does.</p>
</div>
<div class="sect2">
<h3 id="_readme">5.1. README</h3>
<div class="paragraph">
<p>The README file, written in Markdown or AsciiDoc (like this course) is found at the root of a project / repository.<br>
It is the gateway for an unknown project.</p>
</div>
<div class="paragraph">
<p>It answers the following questions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What is the use of this project ?</p>
</li>
<li>
<p>How to use it ? (build tool, etc.)</p>
</li>
<li>
<p>How to contact other stakeholders</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Very popular in open-source projects, the README file is also important in a corporate context, since multiple projects coexists in the same information system and multiple teams must work together.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/readme_sample.png" alt="readme sample">
</div>
<div class="title">Figure 5. README file of the Spring project</div>
</div>
</div>
<div class="sect2">
<h3 id="_c4">5.2. C4</h3>
<div class="paragraph">
<p><strong>C4</strong> is an approach for documenting the architecture, without mixing contexts.</p>
</div>
<div class="paragraph">
<p>The first thing needed, is a common vocabulary (as in DDD) with which all stakeholders <strong><em>understand</em></strong> each other.</p>
</div>
<div class="paragraph">
<p>This is a decisive step, which avoids lack of understanding afterward.</p>
</div>
<div class="paragraph">
<p>This vocabulary is used to draw the diagrams representing the project.</p>
</div>
<div class="sect3">
<h4 id="_context">5.2.1. Context</h4>
<div class="paragraph">
<p>The <strong><em>context</em> diagram</strong> allows to understand key features of the system <span class="underline">without</span> displaying how the system is organized.</p>
</div>
<div class="paragraph">
<p>The system is represented by a unique shape (black box) which interacts with user personas or other systems.</p>
</div>
<div class="paragraph">
<p>The details (technologies, protocols, etc.) are irrelevant in this diagram, which should be understood by non-technical stakeholders.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/c4_context_diagram.png" alt="c4 context diagram">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_container">5.2.2. Container</h4>
<div class="paragraph">
<p>Once features are laid down, we can zoom in one notch with the  <strong><em>container</em> diagram</strong></p>
</div>
<div class="paragraph">
<p>By <em>container</em>, we mean all system hosting code or data (application, database, broker, etc.).</p>
</div>
<div class="paragraph">
<p>This diagram reflects the "big-picture" architecture of the system and allow to see how <span class="underline">responsibilities</span> are distributed among the different software pieces.</p>
</div>
<div class="paragraph">
<p>Can be represented:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Security</strong> : networks, encoded traffic, traceability, etc.</p>
</li>
<li>
<p><strong>Scalability</strong> : load-balancers, (SPOF), etc.</p>
</li>
<li>
<p><strong>Reliability</strong> : backups, replicas, etc</p>
</li>
<li>
<p><strong>Supervision</strong> : probes, metric storage, IHM, etc.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/c4_container_diagram.png" alt="c4 container diagram">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_component">5.2.3. Component</h4>
<div class="paragraph">
<p><em>Zooming</em> in one more notch on each container is possible with the <strong><em>component</em> diagram</strong>.</p>
</div>
<div class="paragraph">
<p>This diagram details the composition of one container, with possible representation of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Intersecting features</p>
</li>
<li>
<p>Business service</p>
</li>
<li>
<p>Workflow</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A component as a logical identity, one <span class="underline">responsability</span>, and interacts with other components.</p>
</div>
<div class="paragraph">
<p>Here, implementation details and technical choices are relevant since these diagrams can be the most technical of a project.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/c4_component_diagram.png" alt="c4 component diagram">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_class">5.2.4. Class</h4>
<div class="paragraph">
<p>If necessary, we can go down more using the classic <strong>UML <em>class</em> diagram</strong>.</p>
</div>
<div class="paragraph">
<p>Rarely useful if needs are clear and responsibilities well divided.</p>
</div>
<div class="paragraph">
<p>However to represent a complex behavior, this diagram can shine a light on a complex interaction between several objects.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/c4_class_diagram.jpg" alt="c4 class diagram">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adr_architectural_decision_records">5.3. ADR (Architectural Decision Records)</h3>
<div class="paragraph">
<p><strong>ADR</strong> are a log with each entry regarding a structuring choice made in the project architecture.</p>
</div>
<div class="paragraph">
<p>It is written by the software engineers and stored (most of the time) next to the code, in the same repository.</p>
</div>
<div class="paragraph">
<p>Reading this log allows to understand why and how an application was built this way.</p>
</div>
<div class="paragraph">
<p>Each entry is composed of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The date</p>
</li>
<li>
<p>Involved stakeholders</p>
</li>
<li>
<p>The context: what lead to this choice (security, organisational, performance issue, etc.)</p>
</li>
<li>
<p>Different solutions considered</p>
</li>
<li>
<p>The decision</p>
</li>
<li>
<p>Expected consequences</p>
</li>
<li>
<p>Optionally a state, which shows that the question was mentioned, analyzed, but that nothing came out of it</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_api_documentation">5.4. API documentation</h3>
<div class="paragraph">
<p>APIs can be documented in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Contract First</strong> : the API specification is written (OpenAPI, RAML, WSDL, etc.) first, then the matching code is written or generated.<br>
If the code is generated, there always is a manual step to wire it to the business code.</p>
</li>
<li>
<p><strong>Code First</strong> : the code is written first.<br>
This code can be enhanced with metadata of the API (description, explanations for each error codes, etc.)<br>
The documentation is then generated based on the code, particularly with the emergence of <strong>OpenAPI</strong> (formerly Swagger) and various tools in its ecosystem.<br>
Such a documentation evolves as code does.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>code first</strong> approach is the most durable, as it avoids a drift between documentation and code to grow over time.</p>
</div>
<div class="paragraph">
<p>In any case, modifying an API must be taken carefully, as it may lead to breaking changes for end users (and this can have business consequences).</p>
</div>
<div class="paragraph">
<p>Some changes have no consequences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a new field in a response</p>
</li>
<li>
<p>Remove an optional field from a request</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>&#8594; <em>What do the most can also do the least</em>.</p>
</div>
<div class="paragraph">
<p>Other changes, have consequences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Delete a field from a response</p>
</li>
<li>
<p>Add a mandatory field in a request</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And will lead to communication errors and needs to be operated differently.</p>
</div>
<div class="paragraph">
<p>In the case of a change with breaking changes is needed, it must be introduced with a new version of the API, while maintaining the old version.</p>
</div>
<div class="paragraph">
<p>This way, customers have the time to operate the necessary change of code on their side to use the new version.<br>
When all customers hav moved on to the new version, the previous one can be deleted.</p>
</div>
<div class="paragraph">
<p>This approach introduces a <strong><em>low coupling</em></strong> between systems allowing them to evolve at different paces.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bdd_and_atdd">5.5. BDD and ATDD</h3>
<div class="paragraph">
<p><strong>B</strong>ehavior <strong>D</strong>riven <strong>D</strong>evelopment and <strong>A</strong>cceptance <strong>T</strong>est <strong>D</strong>riven <strong>D</strong>evelopment are two similar technics focused on describing the features in a way all stakeholders can understand them.<br>
The result is often written in natural language (English, French, etc.) and uses unequivocal vocabulary.</p>
</div>
<div class="paragraph">
<p>This vocabulary is used to form sentences in different tests, which are associated to code.</p>
</div>
<div class="paragraph">
<p>These tests are <span class="underline"><strong><em>executable</em></strong></span> and <em>understood by all</em>.</p>
</div>
<div class="paragraph">
<p>As with the TDD, it is more a work management system than a testing technique.</p>
</div>
<div class="paragraph">
<p>The way these tests are constructed encourage composition and gives stakeholders a better independence and understanding.</p>
</div>
<div class="paragraph">
<p>BDD formalize how tests are written, with constraints similar to those of a <em>unit test</em>.<br>
Sentences must start with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Given</strong> : initial conditions, zero, one, or more &#8594; <strong>[0..*]</strong></p>
</li>
<li>
<p><strong>When</strong> : triggering event, there must be one and only one &#8594; <strong>[1]</strong></p>
</li>
<li>
<p><strong>Then</strong> : assertions, there must be at least one &#8594; <strong>[1..*]</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 7. Feature description using the <strong>Gherkin</strong> format</div>
<div class="content">
<pre class="highlight"><code class="language-gherkin" data-lang="gherkin">Feature: Is it Friday yet?
Everybody wants to know when it's Friday

  Scenario: Sunday isn't Friday
    Given today is Sunday
    When I ask whether it's Friday yet
    Then I should be told "Nope"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 8. Sentences associations to code</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Stepdefs {
    private String today;
    private String actualAnswer;

    @Given("today is Sunday") // <b class="conum">(1)</b>
    public void today_is_Sunday() {
        today = "Sunday";
    }

    @When("I ask whether it's Friday yet")
    public void i_ask_whether_it_s_Friday_yet() {
        actualAnswer = IsItFriday.isItFriday(today);
    }

    @Then("I should be told {string}")
    public void i_should_be_told(String expectedAnswer) {
        assertEquals(expectedAnswer, actualAnswer);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Annotation supplied by the <strong>Cucumber</strong> test framework</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_technics_best_practices">6. Technics &amp; best practices</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kiss_yagni_dry">6.1. KISS, YAGNI &amp; DRY</h3>
<div class="paragraph">
<p>Some popular principles among developers communities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>K</strong>eep <strong>I</strong>t <strong>S</strong>tupid <strong>S</strong>imple : The simpler, the better.<br>
However do something in a simple way can be a difficult exercise.</p>
</li>
<li>
<p><strong>Y</strong>ou <strong>A</strong>inât <strong>G</strong>onna <strong>N</strong>eed <strong>I</strong>t : Only add code useful at the time of its writing.<br>
Predictions on how a piece of software will evolve are often wrong and code structure that was planned may be an obstacle for real evolutions.</p>
</li>
<li>
<p><strong>D</strong>onât <strong>R</strong>epeat <strong>Y</strong>ourself : Duplication is frowned upon by developers, and bring several issues :</p>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s more work, as the same code needs to be written, tested and maintained several times</p>
</li>
<li>
<p>In case of a bug, multiple fixes must be done, and some may be forgotten</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This same simplicity can be found in two of the twelve principles of the <strong>Agile Manifesto</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Our highest priority is to satisfy the customer through early and continuous delivery of <span class="underline"><strong>valuable</strong></span> software</p>
</li>
<li>
<p>Simplicity [the art of maximizing the amount of work not done] is essential.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_log_management">7. Log management</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Listing 9. Example of useless log</div>
<div class="content">
<pre class="highlight"><code>2017-02-04 22:33:12 [thread-1] com.github.some.project.DatabaseService l.74 #################
2017-02-04 22:33:12 [thread-2] com.github.some.project.DatabaseService l.75 START
2017-02-04 22:33:12 [thread-1] com.github.some.project.DatabaseService l.93 STOP in 17ms
2017-02-04 22:33:12 [thread-2] com.github.some.project.DatabaseService l.94 #################
2017-02-04 22:33:12 [thread-1] com.github.some.project.DatabaseService l.124 java.sql.SQLIntegrityConstraintViolationException
at org.h2.message.DbException.getJdbcSQLException(DbException.java:345)
at org.h2.message.DbException.get(DbException.java:179)
at org.h2.message.DbException.get(DbException.java:155)
at org.h2.command.CommandContainer.update(CommandContainer.java:98)
at org.h2.command.Command.executeUpdate(Command.java:258)
at org.h2.jdbc.JdbcPreparedStatement.execute(JdbcPreparedStatement.java:201)
... 50 more</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 10. A little better</div>
<div class="content">
<pre class="highlight"><code>2017-02-04 22:33:12.332 INFO  5jhgd45ui74h c.g.s.p.UserService.create [Joshua] [Bloch] Save successful
2017-02-04 22:33:12.758 INFO  6jyg45hgduyg c.g.s.p.UserService.create [Doug] [Lea] Save successful
2017-02-04 22:33:12.964 ERROR hg457gehe4rt c.g.s.p.UserService.create [James] [Gosling] Save KO: already exists</code></pre>
</div>
</div>
<div class="paragraph">
<p>Log <em>files</em> contain all information needed to diagnose issues.<br>
These information can also bu used to build metrics for supervising the system.<br>
Logs are often the sole source of the event chronology and are especially important in high traffic applications where finding the issue of a particular user can seem like looking for a needle in a haystack.</p>
</div>
<div class="sect2">
<h3 id="_log_libraries">7.1. Log libraries</h3>
<div class="paragraph">
<p>On the app side, there are many library to help write log events.</p>
</div>
<div class="paragraph">
<p>Just in the Java ecosystem, we can find:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JUL (<strong>J</strong>ava <strong>U</strong>til <strong>L</strong>ogging) minimalist, supplied by the JDK</p>
</li>
<li>
<p>Apache JULI (<strong>J</strong>ava <strong>U</strong>til <strong>L</strong>ogging <strong>I</strong>nterface)</p>
</li>
<li>
<p>Apache Commons Logging</p>
</li>
<li>
<p>Apache Log4J</p>
</li>
<li>
<p>JBoss Logging</p>
</li>
<li>
<p>Logback</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We find in these various tools common concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Low coupling between the component that collects log events (<code>Logger</code>) and the one which write them outside the system (<code>Appender</code>)</p>
</li>
<li>
<p>Configuration outside the code (file, system properties, etc.)</p>
</li>
<li>
<p>Severity levels:</p>
<div class="ulist">
<ul>
<li>
<p><strong>DEBUG</strong> : use during the development phase, invisible once the application is deployed</p>
</li>
<li>
<p><strong>INFO</strong> : information about an event in the system (state change, or reaction to an outside trigger)</p>
</li>
<li>
<p><strong>WARN</strong> : an error happened, the system did not behave as expected, but no manual intervention is immediately needed</p>
</li>
<li>
<p><strong>ERROR</strong> : an error happened, a human intervention is required to fix the system</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A business error is not necessarily a technical error.<br>
For example: a user entering the wrong password is a normal business case, handled in the code, and the matching event (if recorded) is of <strong>INFO</strong> level.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_slf4j_architecture">7.1.1. SLF4J architecture</h4>
<div class="paragraph">
<p>The issue with having this many tools for writing log is that the ecosystem is mixed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tomcat uses <strong>JUL</strong> through the <strong>JULI</strong> abstraction</p>
</li>
<li>
<p>Spring uses <strong>Apache Commons Logging</strong>.</p>
</li>
<li>
<p><strong>HBase</strong> official client uses <strong>Log4j</strong>.</p>
</li>
<li>
<p>Etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One application,using different frameworks and libraries, should then configure each of these <em>logging</em> libraries in a consistent way (same event format, files, retained severity, etc.).</p>
</div>
<div class="paragraph">
<p>It would be not only annoying, but also error prone (race condition on the same file, configuration oversight, etc.).</p>
</div>
<div class="paragraph">
<p>However, <strong>SLF4J</strong> was designed to unify all these tools.</p>
</div>
<div class="paragraph">
<p><strong>SLF4J</strong> is made of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <strong><em>abstract API</em></strong> forming a unique facade for various but common logging features</p>
</li>
<li>
<p><strong><em>Adapters</em></strong> between this API and existing log libraries</p>
</li>
<li>
<p><strong><em>Bridges</em></strong>, libraries having the same binary compatibility (same qualified class names, same method signatures) as existing log libraries, but redirecting calls to the <strong><em>abstract API</em></strong></p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/slf4j_bridges.png" alt="slf4j bridges">
</div>
</div>
<div class="paragraph">
<p>Using <strong>SLF4J</strong> means redirecting all logs to this <strong><em>abstract API</em></strong> and send them one unique implementation.</p>
</div>
<div class="paragraph">
<p>Configuration is then done once.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mdc_mapped_diagnostic_context">7.1.2. MDC (Mapped Diagnostic Context)</h4>
<div class="paragraph">
<p>The <strong>MDC</strong> is a tool supplied by many log libraries which allows to transport information in a same thread.</p>
</div>
<div class="paragraph">
<p>The goal is to enhance event information with common data as they are available, without having to pass them as parameters in each methods.</p>
</div>
<div class="paragraph">
<p>Consider this code:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. File MyController.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class MyController {

    private final MyService service;

    public User newUser(User user, @Header("correlationId") String correlationId) {
        return service.newUser(user, correlationId);
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 12. File MyService.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class MyService {

    private final Logger logger = LoggerFactory.getLogger(MyService.class);
    private final MyRepository repository;

    public User newUser(User user, String correlationId) {
        if(isValid(user, correlationId)) {
            return repository.save(user, correlationId);
        } else {
            throw new InvalidUserException();
        }
    }

    private boolean isValid(User user, String correlationId) {
        if(user.age &gt; 110) {
            logger.info("[" + correlationId + "] Invalid User: too old");
            return false;
        } else if(user.age &lt; 1) {
            logger.info("[" + correlationId + "] Invalid User: too young");
            return false;
        }
        return true;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>correlationId</code> variable is systematically passed because it is required to log it each time, allowing later reconciliation of multiple events matching the same user trigger.</p>
</div>
<div class="paragraph">
<p>It is a good fit for the <strong>MDC</strong> use:</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. File MyController.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class MyController {

    private final MyService service;

    public User newUser(User user, @Header("correlationId") String correlationId) {
        MDC.put("correlationId", correlationId);
        return service.newUser(user);
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 14. File MyService.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class MyService {

    private final Logger logger = LoggerFactory.getLogger(MyService.class);
    private final MyRepository repository;

    public User newUser(User user) {
        if(isValid(user)) {
            return repository.save(user);
        } else {
            throw new InvalidUserException();
        }
    }

    private boolean isValid(User user) {
        if(user.age &gt; 110) {
            logger.info("Invalid User: too old");
            return false;
        } else if(user.age &lt; 1) {
            logger.info("Invalid User: too young");
            return false;
        }
        return true;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>MDC variables we want to appear should then be configured in the output format.</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. File logback.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;configuration&gt;

  &lt;appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender"&gt;
    &lt;encoder&gt;
      &lt;pattern&gt;%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - [%X{correlationId}] %msg%n&lt;/pattern&gt; &lt;!--<b class="conum">(1)</b>--&gt;
    &lt;/encoder&gt;
  &lt;/appender&gt;

  &lt;root level="DEBUG"&gt;
    &lt;appender-ref ref="STDOUT" /&gt;
  &lt;/root&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Pattern used to write events in the console</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gc_logs">7.2. GC logs</h3>
<div class="paragraph">
<p>Causes of an issue can be technical, and related to the <strong>G</strong>arbarge <strong>C</strong>ollector.</p>
</div>
<div class="paragraph">
<p>So it is important to enable its logs, using a flag when starting the JVM:</p>
</div>
<div class="paragraph">
<p><code>-Xlog:gc=debug:file=gc.log:pid,time,uptimemillis:filecount=5,filesize=1M</code></p>
</div>
<div class="paragraph">
<p>In this example, the JVM will write GC events of minimal <strong>debug</strong> severity in file named <strong>gc.log</strong> (with a rotation on 5 files maximum of 1M each) with additional information: PID (processus ID), time and execution duration.</p>
</div>
<div class="paragraph">
<p>More options here: <a href="https://openjdk.java.net/jeps/158" class="bare">https://openjdk.java.net/jeps/158</a></p>
</div>
<div class="paragraph">
<p><span class="underline">Alternately</span>, metrics collection tools like <strong>Micrometer</strong> can export these information to time-series ingesting systems, such as <strong>Graphite</strong>, <strong>Warp10</strong> or <strong>Prometheus</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_heap_dump">7.3. Heap Dump</h3>
<div class="paragraph">
<p>When the JVM stops unexpectedly, this can be due to an <strong>O</strong>ut <strong>O</strong>f <strong>M</strong>emory error, and the investigation can be done using a <strong>Heap Dump</strong>.</p>
</div>
<div class="paragraph">
<p>A <strong>Heap Dump</strong> is the projection in a file of the memory state of the JVM.</p>
</div>
<div class="paragraph">
<p>This flag needs to be added when starting the JVM, so that such a file is produced in case of a crash:</p>
</div>
<div class="paragraph">
<p><code>-XX:+HeapDumpOnOutOfMemoryError</code></p>
</div>
<div class="paragraph">
<p>Produced files can be analyzed with tools such as <strong>Eclipse MAT</strong> (free) or <strong>JProfiler</strong> (licensed).<br>
=== Centralized log management</p>
</div>
<div class="paragraph">
<p>In order to simplify the process of searching some event in log files, it is important to centralized them.</p>
</div>
<div class="paragraph">
<p>This means send them in the same place, whether it be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A file system, in which the <code>grep</code> command can be used</p>
</li>
<li>
<p><em>ElasticSearch</em>, <em>Loki</em> or equivalent, in which logs can be queried</p>
</li>
<li>
<p>A SAAS solution whose job it is (<em>Datadog</em>, <em>Logz.io</em>, etc.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Logs must be obvious and provide the maximum information possible.<br>
This is why visual visual logging or <em>debug</em> events must not be sent to such systems.</p>
</div>
<div class="sect3">
<h4 id="_the_elastic_stack">7.3.1. The Elastic stack</h4>
<div class="paragraph">
<p>The most popular solution of log centralization (among others) is the <em>Elastic</em> one: <strong>ELK</strong> (<strong>E</strong>lasticSearch, <strong>L</strong>ogstash, <strong>K</strong>ibana).<br>
Each of its component can be replaced by another tool, and the chain can be more complex to handle scaling, but the structure, nevertheless, stay the same.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/elk_stack.png" alt="elk stack">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Logstash</strong> slices log lines into structured documents (JSON) and send them to <strong>ElasticSearch</strong></p>
</li>
<li>
<p><strong>ElasticSearch</strong> indexes them and supply an API to query these indexes</p>
</li>
<li>
<p><strong>Kibana</strong> is a web interface to create dashboards and search arbitrary data</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_supervision">8. Supervision</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Collecting logs and metrics is the ground on which supervision is built.</p>
</div>
<div class="paragraph">
<p>On this, we add components to refine data into:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Alerts, triggered when an abnormal behavior is detected</p>
</li>
<li>
<p>Dashboards, to investigate an issue, find correlations and converge on the issue origin</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Supervision is the tool that allows to follow the system state, understand its operation and even predict its use.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Advice</div>
</td>
<td class="content">
<div class="paragraph">
<p>Beware to only keep relevant data in such systems, as it can grow very fast and it can become tricky to navigate in the significant amount of data.</p>
</div>
<div class="paragraph">
<p>The end product is built with the help of these three questions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What are the behavior of the system identified as abnormal? (unavailable service, high resource usage, etc.)</p>
</li>
<li>
<p>What system behavior do we want to understand? (water hammer, external service unavailability, etc.)</p>
</li>
<li>
<p>Where to put the probes that will generate necessary metrics ?</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tools for document indexation, storage of time-series or databases, all are information source that can be leveraged to build dashboards and alerts.</p>
</div>
<div class="paragraph">
<p>Today, the most popular choice among open-source tools for aggregating such data is Grafana.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/grafana.png" alt="grafana">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To the contrary of what french industry tries to make us believe, being a software architect is not a job separated from being a developer.</p>
</div>
<div class="paragraph">
<p>Architectural questions must be handled by the development team, each one having its own experience and interest to a specific matter.</p>
</div>
<div class="paragraph">
<p>It is the job of <span class="underline">software engineers</span> to think about the consequences of their doing, as they will face them anyway, once the product is in production.</p>
</div>
<div class="paragraph">
<p>Software architecture, as for technology monitoring, is an integral part of the tools portfolio of the developer.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_to_go_further">To go further</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Out of the tar pit, essay on complexity<br>
<a href="https://github.com/papers-we-love/papers-we-love/blob/master/design/out-of-the-tar-pit.pdf" class="bare">https://github.com/papers-we-love/papers-we-love/blob/master/design/out-of-the-tar-pit.pdf</a></p>
</li>
<li>
<p>Agile Manifesto<br>
<a href="https://agilemanifesto.org/" class="bare">https://agilemanifesto.org/</a></p>
</li>
<li>
<p>Blogs of</p>
<div class="ulist">
<ul>
<li>
<p>Martin Fowler<br>
<a href="https://martinfowler.com/" class="bare">https://martinfowler.com/</a></p>
</li>
<li>
<p>Simon Brown<br>
<a href="https://www.codingthearchitecture.com/" class="bare">https://www.codingthearchitecture.com/</a></p>
</li>
<li>
<p>Jessie Frazelle<br>
<a href="https://blog.jessfraz.com/" class="bare">https://blog.jessfraz.com/</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Conference videos on YouTube</p>
<div class="ulist">
<ul>
<li>
<p>Devoxx</p>
</li>
<li>
<p>goto;</p>
</li>
<li>
<p>DevFest</p>
</li>
<li>
<p>JUGs (<strong>J</strong>ava <strong>U</strong>ser <strong>G</strong>roup)</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Tech news websites</p>
<div class="ulist">
<ul>
<li>
<p>InfoQ <a href="https://www.infoq.com/fr/" class="bare">https://www.infoq.com/fr/</a></p>
</li>
<li>
<p>Developpez (FR) <a href="https://www.developpez.com/" class="bare">https://www.developpez.com/</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>
</body>
</html>